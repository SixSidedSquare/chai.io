(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};ChaiIo.Views.NewReport=function(e){function n(e){this.events={"submit .form":"copyQueryValue","click #commit":"submitForm"},n.__super__.constructor.call(this,e)}return t(n,e),n.prototype.render=function(){return this.initQueryEditor()},n.prototype.initQueryEditor=function(){this.editor=ace.edit("editor"),this.editor.setTheme("ace/theme/textmate"),this.editor.getSession().setMode("ace/mode/sql"),this.editor.setValue(this.getQueryTAValue());if(this.getEditorValue()!=="")return this.editor.selection.setSelectionRange({start:0,end:0})},n.prototype.getQueryTextArea=function(){return $("#query")},n.prototype.getQueryTAValue=function(){return this.getQueryTextArea().val()},n.prototype.getEditorValue=function(){return this.editor.getValue()},n.prototype.copyQueryValue=function(e){return this.getQueryTextArea().val(this.getEditorValue())},n.prototype.getConfigField=function(e){return $("#report_config_"+e).val().trim()},n.prototype.submitForm=function(){this.copyQueryValue();if(this.validated())return $(".form").submit()},n.prototype.reservedPlaceholders=function(){return["id"]},n.prototype.isReservedPlaceholder=function(e){return _.indexOf(this.reservedPlaceholders(),e)>=0},n.prototype.isPlaceholderInQuery=function(e){return this.getQueryTAValue().concat(" ").match(":"+e+"[$|;|,| ]")!==null},n.prototype.checkPlaceholders=function(){var e,t,n,r,i;n=$("input[id*=report_filters_placeholder]");for(r=0,i=n.length;r<i;r++){e=n[r],t=$(e).val();if(t==="")continue;if(this.isReservedPlaceholder(t))return this.alert("Placeholder '"+t+"' is a reserved parameter and cannot be used as a placeholder"),this.notifyError("Invalid Placeholder"),!1;if(!this.isPlaceholderInQuery(t))return this.alert("Placeholder '"+t+"' is not present in the query"),this.notifyError("Invalid Placeholder"),!1}return!0},n.prototype.checkAggFields=function(){var e,t,n;return this.getConfigField("sum").length===0&&this.getConfigField("average").length===0?!0:(n=this.getConfigField("sum").split(","),e=this.getConfigField("average").split(","),t=_.intersection(n,e),t.length>0?(this.alert("Following field(s) can either belong to sum or average but not both: <br/> "+t),this.notifyError("Invalid Aggregation fields"),!1):!0)},n.prototype.validated=function(){return this.checkPlaceholders()?this.checkAggFields()?!0:!1:!1},n.prototype.queryStructure=function(){},n}(ChaiIo.Views.Base)}).call(this);